2018-10-16 07:54:47.236 [aurora.application.session_check] [CONFIG] Session data copied to context
2018-10-16 07:54:47.236 [aurora.application.session_check] [CONFIG] Checking BM access wfl.WFL5130.wfl_finish_instance_query for operation query
2018-10-16 07:54:47.237 [aurora.application.session_check] [CONFIG] Result from aurora.bm.DefaultAccessChecker@52d2613b is true
2018-10-16 07:54:47.237 [uncertain.proc] [CONFIG] [action] AccessCheck
2018-10-16 07:54:47.239 [uncertain.proc] [CONFIG] [action] CheckServiceLock
2018-10-16 07:54:47.239 [uncertain.proc] [CONFIG] [action] ParseParameter
2018-10-16 07:54:47.239 [uncertain.proc] [CONFIG] [action] ValidateInput
2018-10-16 07:54:47.239 [uncertain.proc] [CONFIG] [action] InvokeService
2018-10-16 07:54:47.239 [aurora.database] [CONFIG] ===================================== prepare to run model-query wfl.WFL5130.wfl_finish_instance_query==============================
2018-10-16 07:54:47.243 [uncertain.proc] [CONFIG] [action] DecideSqlGenerationMode
2018-10-16 07:54:47.243 [uncertain.proc] [FINE] aurora.database.service.BusinessModelService.onDecideSqlGenerationMode
2018-10-16 07:54:47.243 [uncertain.proc] [CONFIG] [action] CreateOperationSql
2018-10-16 07:54:47.243 [uncertain.proc] [CONFIG] [action] PopulateOperationSql
2018-10-16 07:54:47.243 [uncertain.proc] [FINE] aurora.database.features.OrderByClauseCreator.onPopulateOperationSql
2018-10-16 07:54:47.243 [uncertain.proc] [FINE] aurora.database.features.WhereClauseCreator.onPopulateOperationSql
2018-10-16 07:54:47.244 [uncertain.proc] [CONFIG] [action] ExecuteQuery
2018-10-16 07:54:47.244 [uncertain.proc] [FINE] aurora.bm.QuerySqlCreator.onExecuteQuery
2018-10-16 07:54:51.135 [uncertain.proc] [CONFIG] [action] QueryFinish
2018-10-16 07:54:51.135 [uncertain.proc] [FINE] aurora.database.features.AutoQueryCounter.onQueryFinish
2018-10-16 07:54:51.249 [uncertain.proc] [CONFIG] [action] FetchResultSet
2018-10-16 07:54:51.249 [uncertain.proc] [FINE] aurora.database.features.CacheBasedLookUpField.postFetchResultSet
2018-10-16 07:54:51.249 [aurora.database] [CONFIG] 
============= BEGIN [query] SQL Statement execution dump ============

                SELECT
                    t.*,
                    DECODE(t.last_approve_name, NULL, NULL, TO_CHAR(t.last_update_date, 'yyyy-mm-dd hh24:mi')) last_update_date_desc,
                    (SELECT pay_failure_pkg.return_pay_status(t.order_no) FROM dual
                    ) pay_status,
                    (SELECT
                        TO_CHAR(MAX(v.transaction_date),'yyyy-mm-dd')
                    FROM
                        tran_num_doc_mun_states_v v
                    WHERE
                        v.doc_number = t.order_no
                    ) pay_date,
                    (SELECT
                        pay_failure_pkg.return_audit_date(t.order_no,t.workflow_category)
                    FROM
                        dual
                    ) audit_date,
                    (SELECT
                        DECODE(pay_failure_pkg.return_audit_status(t.order_no,t.workflow_category),'Y','复核通过','R','初审通过','N','未审核')
                    FROM
                        dual
                    ) audit_flag_desc
                FROM
                    (SELECT
                        rs.*,
                        TO_CHAR(rs.creation_date, 'yyyy-mm-dd hh24:mi') creation_date_desc,
                        (SELECT
                            code_value_name
                        FROM
                            sys_service_lookup_v
                        WHERE
                            code       = 'WFL_WORKFLOW_INSTANCE_STATUS' AND
                            code_value = TO_CHAR(rs.status) AND
                            language   = 'ZHS'
                        ) status_name,
                        wfl_common_pkg.get_current_node(rs.workflow_id, rs.instance_id, rs.current_node) curr_approve_name,
                        wfl_common_pkg.get_wfl_user_name(rs.created_by) create_by_name,
                        wfl_common_pkg.get_wfl_user_name(
                        (SELECT
                            r.created_by
                        FROM
                            wfl_approve_record r
                        WHERE
                            r.record_id =
                            (SELECT
                                MAX(record_id)
                            FROM
                                wfl_approve_record
                            WHERE
                                instance_id = rs.instance_id
                            )
                        )) last_approve_name,
                        (SELECT
                            r.note
                        FROM
                            wfl_approve_record r
                        WHERE
                            r.record_id =
                            (SELECT
                                MAX(record_id)
                            FROM
                                wfl_approve_record
                            WHERE
                                instance_id = rs.instance_id
                            )
                        ) last_approve_note,
                        (SELECT
                            wdr.document_desc
                        FROM
                            wfl_document_reference_vl wdr
                        WHERE
                            rs.workflow_category = wdr.workflow_category
                        ) order_type,
                        TO_CHAR(
                        (SELECT
                            MAX(nr.date_limit)
                        FROM
                            wfl_instance_node_recipient nr,
                            wfl_workflow_node n
                        WHERE
                            nr.instance_id = rs.instance_id AND
                            nr.node_id     = n.node_id AND
                            n.sequence_num = rs.current_node
                        ), 'yyyy-mm-dd hh24:mi') date_limit
                    FROM
                        (SELECT
                            a.instance_id,
                            a.workflow_id,
                            a.current_node,
                            a.created_by,
                            a.creation_date,
                            a.document_number order_no,
                            b.name workflow_name,
                            a.last_update_date,
                            b.workflow_category,
                            a.status,
                            a.status_desc,
                            a.instance_amount
                        FROM
                            wfl_workflow_instance a,
                            Wfl_Workflow_Vl b
                        WHERE
                            a.workflow_id = b.workflow_id AND
                            a.created_by  = ?
                        UNION
                        SELECT
                            A.INSTANCE_ID,
                            A.WORKFLOW_ID,
                            A.CURRENT_NODE,
                            A.CREATED_BY,
                            A.CREATION_DATE,
                            A.DOCUMENT_NUMBER ORDER_NO,
                            B.NAME WORKFLOW_NAME,
                            A.LAST_UPDATE_DATE,
                            B.WORKFLOW_CATEGORY,
                            A.STATUS,
                            A.STATUS_DESC,
                            A.INSTANCE_AMOUNT
                        FROM
                            WFL_WORKFLOW_INSTANCE A,
                            WFL_WORKFLOW_VL B
                        WHERE
                            A.WORKFLOW_ID = B.WORKFLOW_ID AND
                            EXISTS
                            (SELECT
                                1
                            FROM
                                exp_report_headers rep
                            WHERE
                                rep.exp_report_header_id = a.instance_param AND
                                rep.exp_report_number    = a.document_number AND
                                rep.employee_id          =
                                (SELECT u.employee_id FROM sys_user u WHERE u.user_id = ?
                                ) AND
                                b.workflow_category = 'EXP_REPORT'
                            UNION ALL
                            SELECT
                                1
                            FROM
                                exp_requisition_headers req
                            WHERE
                                req.exp_requisition_header_id = a.instance_param AND
                                req.exp_requisition_number    = a.document_number AND
                                req.employee_id               =
                                (SELECT u.employee_id FROM sys_user u WHERE u.user_id = ?
                                ) AND
                                b.workflow_category = 'EXP_REQUISITION'
                            UNION ALL
                            SELECT
                                1
                            FROM
                                CSH_PAYMENT_REQUISITION_HDS crh
                            WHERE
                                crh.payment_requisition_header_id = a.instance_param AND
                                crh.requisition_number            = a.document_number AND
                                crh.employee_id                   =
                                (SELECT u.employee_id FROM sys_user u WHERE u.user_id = ?
                                ) AND
                                b.workflow_category = 'PAYMENT_REQUISITION'
                            UNION ALL
                            SELECT
                                1
                            FROM
                                acp_acp_requisition_hds acr
                            WHERE
                                acr.acp_requisition_header_id = a.instance_param AND
                                acr.requisition_number        = a.document_number AND
                                acr.employee_id               =
                                (SELECT u.employee_id FROM sys_user u WHERE u.user_id = ?
                                ) AND
                                b.workflow_category = 'ACP_REQUISITION'
                            UNION ALL
                            SELECT
                                1
                            FROM
                                BGT_JOURNAL_HEADERS bjh
                            WHERE
                                bjh.journal_header_id     = a.instance_param AND
                                bjh.budget_journal_number = a.document_number AND
                                bjh.employee_id           =
                                (SELECT u.employee_id FROM sys_user u WHERE u.user_id = ?
                                ) AND
                                b.workflow_category = 'BUDGET_JOURNAL'
                            UNION ALL
                            SELECT
                                1
                            FROM
                                GLD_WORK_ORDER_HEADERS gwo
                            WHERE
                                gwo.work_order_header_id = a.instance_param AND
                                gwo.work_order_number    = a.document_number AND
                                gwo.employee_id          =
                                (SELECT u.employee_id FROM sys_user u WHERE u.user_id = ?
                                ) AND
                                b.workflow_category = 'WORK_ORDER'
                            )
                        ) rs
                    ) t  WHERE t.status='10' AND t.creation_date > to_date(?, 'yyyy-mm-dd') AND t.creation_date < to_date(?, 'yyyy-mm-dd') + 1 ORDER BY order_no desc
            
---------------------Binding info---------------------
No.1	Access path:/session/@user_id	Data type of passed value :java.lang.Long	Value:213	Output:false	Database Type:null	
No.2	Access path:/session/@user_id	Data type of passed value :java.lang.Long	Value:213	Output:false	Database Type:null	
No.3	Access path:/session/@user_id	Data type of passed value :java.lang.Long	Value:213	Output:false	Database Type:null	
No.4	Access path:/session/@user_id	Data type of passed value :java.lang.Long	Value:213	Output:false	Database Type:null	
No.5	Access path:/session/@user_id	Data type of passed value :java.lang.Long	Value:213	Output:false	Database Type:null	
No.6	Access path:/session/@user_id	Data type of passed value :java.lang.Long	Value:213	Output:false	Database Type:null	
No.7	Access path:/session/@user_id	Data type of passed value :java.lang.Long	Value:213	Output:false	Database Type:null	
No.8	Access path:@creation_date_from	Data type of passed value :java.lang.String	Value:2018-07-18	Output:false	Database Type:null	
No.9	Access path:@creation_date_to	Data type of passed value :java.lang.String	Value:2018-10-16	Output:false	Database Type:null	

=============== END [query] SQL Statement execution dump ============

2018-10-16 07:54:51.249 [uncertain.proc] [CONFIG] [action] CreateSuccessResponse
